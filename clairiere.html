<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Énigme 2 — La Danse des Lunes</title>
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body data-scene="clairiere">
    <div id="stars"></div>
    <div id="fireflies" aria-hidden="true"></div>

    <header class="site-header compact">
      <a class="back" href="foret.html" aria-label="Retour">←</a>
      <h1>Énigme 2 · La danse des lunes</h1>
    </header>

    <main class="container">
      <section class="card puzzle">
        <div class="art wide">
          <!-- Forêt de sapins simple -->
          <svg viewBox="0 0 560 200" role="img" aria-label="Forêt de sapins sous la lune">
            <defs>
              <linearGradient id="skyForest" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#0f2030"/>
                <stop offset="100%" stop-color="#08141b"/>
              </linearGradient>
              <linearGradient id="treeBack" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#1f4a3a"/>
                <stop offset="100%" stop-color="#123227"/>
              </linearGradient>
              <linearGradient id="treeMid" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#2a5e4a"/>
                <stop offset="100%" stop-color="#184035"/>
              </linearGradient>
              <linearGradient id="treeFront" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#356f58"/>
                <stop offset="100%" stop-color="#1b483d"/>
              </linearGradient>
              <symbol id="pine" viewBox="0 0 20 28">
                <polygon points="10,0 2,10 6,10 1,16 7,14 4,22 10,19 16,22 13,14 19,16 14,10 18,10"/>
                <rect x="8.5" y="19" width="3" height="8" rx="0.6"/>
              </symbol>
            </defs>

            <!-- Ciel -->
            <rect width="560" height="200" fill="url(#skyForest)"/>
            <!-- Lune unique -->
            <circle cx="460" cy="40" r="16" fill="#fff1cc" opacity="0.95"/>
            <!-- Quelques étoiles discrètes -->
            <g fill="#fff8e6" opacity="0.75">
              <circle cx="60" cy="26" r="1.2"/>
              <circle cx="120" cy="14" r="1.0"/>
              <circle cx="200" cy="34" r="1.1"/>
              <circle cx="260" cy="20" r="0.9"/>
              <circle cx="320" cy="30" r="1.0"/>
              <circle cx="520" cy="24" r="1.1"/>
            </g>

            <!-- Bandes de sapins -->
            <g fill="url(#treeBack)" opacity="0.85">
              <use href="#pine" x="20"  y="152" transform="scale(1.0)"/>
              <use href="#pine" x="60"  y="154" transform="scale(0.9)"/>
              <use href="#pine" x="100" y="150" transform="scale(1.1)"/>
              <use href="#pine" x="140" y="153" transform="scale(1.0)"/>
              <use href="#pine" x="180" y="154" transform="scale(0.95)"/>
              <use href="#pine" x="220" y="151" transform="scale(1.05)"/>
              <use href="#pine" x="260" y="153" transform="scale(0.98)"/>
              <use href="#pine" x="300" y="150" transform="scale(1.06)"/>
              <use href="#pine" x="340" y="154" transform="scale(0.94)"/>
              <use href="#pine" x="380" y="152" transform="scale(1.02)"/>
              <use href="#pine" x="420" y="154" transform="scale(0.94)"/>
              <use href="#pine" x="460" y="151" transform="scale(1.04)"/>
              <use href="#pine" x="500" y="154" transform="scale(0.92)"/>
            </g>
            <g fill="url(#treeMid)" opacity="0.92">
              <use href="#pine" x="10"  y="160" transform="scale(1.15)"/>
              <use href="#pine" x="55"  y="162" transform="scale(1.05)"/>
              <use href="#pine" x="95"  y="160" transform="scale(1.2)"/>
              <use href="#pine" x="145" y="162" transform="scale(1.08)"/>
              <use href="#pine" x="190" y="160" transform="scale(1.18)"/>
              <use href="#pine" x="235" y="162" transform="scale(1.06)"/>
              <use href="#pine" x="280" y="160" transform="scale(1.2)"/>
              <use href="#pine" x="325" y="162" transform="scale(1.08)"/>
              <use href="#pine" x="370" y="160" transform="scale(1.18)"/>
              <use href="#pine" x="415" y="162" transform="scale(1.06)"/>
              <use href="#pine" x="460" y="160" transform="scale(1.16)"/>
              <use href="#pine" x="505" y="162" transform="scale(1.08)"/>
            </g>
            <g fill="url(#treeFront)" opacity="1">
              <use href="#pine" x="0"   y="170" transform="scale(1.3)"/>
              <use href="#pine" x="45"  y="172" transform="scale(1.22)"/>
              <use href="#pine" x="90"  y="170" transform="scale(1.34)"/>
              <use href="#pine" x="140" y="172" transform="scale(1.26)"/>
              <use href="#pine" x="190" y="170" transform="scale(1.36)"/>
              <use href="#pine" x="240" y="172" transform="scale(1.24)"/>
              <use href="#pine" x="290" y="170" transform="scale(1.34)"/>
              <use href="#pine" x="340" y="172" transform="scale(1.26)"/>
              <use href="#pine" x="390" y="170" transform="scale(1.36)"/>
              <use href="#pine" x="440" y="172" transform="scale(1.24)"/>
              <use href="#pine" x="490" y="170" transform="scale(1.32)"/>
              <use href="#pine" x="530" y="172" transform="scale(1.24)"/>
            </g>
          </svg>
        </div>
        <h2>Aligne les phases</h2>
        <p class="riddle">
          "Quand la nuit se lève, c'est le <strong>quart</strong> qui commence.<br/>
          Au zénith elle est <strong>pleine</strong>,
          et vers l'aube elle redevient <strong>croissante</strong>."
        </p>

        <div class="sliders">
          <div class="slider-group">
            <label for="s1">Lune du soir</label>
            <input id="s1" type="range" min="0" max="100" value="50" step="1"/>
            <div class="moon" data-for="s1"></div>
          </div>
          <div class="slider-group">
            <label for="s2">Lune de minuit</label>
            <input id="s2" type="range" min="0" max="100" value="50" step="1"/>
            <div class="moon" data-for="s2"></div>
          </div>
          <div class="slider-group">
            <label for="s3">Lune de l'aube</label>
            <input id="s3" type="range" min="0" max="100" value="50" step="1"/>
            <div class="moon" data-for="s3"></div>
          </div>
        </div>

        <div id="feedback" class="feedback" aria-live="polite"></div>

        <div class="cta-row hidden" id="next2">
          <a class="btn btn-primary" href="ruisseau.html">Suivre le ruisseau</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <small>Clairière des fées</small>
    </footer>

    <script src="assets/main.js"></script>
    <script>
      const targets = { s1:5, s2:50, s3:95 };
      const tol = 8; // tolérance ±6
      const fb = document.getElementById('feedback');
      const next = document.getElementById('next2');

      function updateMoon(input){
        const id = input.id; const moon = document.querySelector(`.moon[data-for="${id}"]`);
        const v = Number(input.value);
        // Représentation simple de phase: gradient radiale selon v
        const pct = Math.max(0, Math.min(100, v));
        const light = pct/100;
        const shadowStart = (0.5 - (light-0.5))*100; // just a playful mapping
        moon.style.background = `radial-gradient(circle at ${shadowStart}% 50%, #fff8dc 35%, #d0c9b0 36%, #2a2a2a 70%)`;
        moon.setAttribute('aria-label',`phase ${v}%`);
      }

      function check(){
        const ok = Object.keys(targets).every(id => {
          const v = Number(document.getElementById(id).value);
          return Math.abs(v - targets[id]) <= tol;
        });
        if (ok) {
          fb.textContent = "La clairière s'illumine… C'est réussi !";
          document.body.classList.add('solved');
          try { localStorage.setItem('puzzle2','true'); localStorage.setItem('progress','2'); } catch {}
          next.classList.remove('hidden');
          celebrate('clairiere');
        } else {
          fb.textContent = "Écoute la nuit… ajuste encore les lunes.";
        }
      }

      document.querySelectorAll('input[type="range"]').forEach(inp => {
        updateMoon(inp);
        inp.addEventListener('input', e => { updateMoon(inp); check(); });
      });

      check();
    </script>
  </body>
  </html>
